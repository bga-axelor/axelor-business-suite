<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

		<grid model="com.axelor.apps.event.db.EventRegistrations" title="Event Registration"
				name="event-registration-grid">
				<field name="event" />
				<field name="name" />
				<field name="email" />
				<field name="address" />
				<field name="registrationDate" />
				<field name="amount" />
				<field name="isSendEmail" />

		</grid>

		<form name="event-registration-form" title="Event Registration"
				model="com.axelor.apps.event.db.EventRegistrations" css="panel-blue"
				onSave="event-action-group-registration-validation,save,event-action-registration-change-event-details">
				<panel>
						<field name="isSendEmail" readonly="true" />
						<field name="event" onChange="action-event-group-comput-registration-amount"
								if="_isOpenFromMenu" />
						<field name="name" />
						<field name="email"
								pattern="^[a-z0-9A-ZáàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ!#$%&amp;'*+/=?^_`{|}~-]+(?:\.[a-z0-9A-ZáàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ!#$%&amp;'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+(?:[a-z]{2,})$" />
						<field name="address" />
						<field name="registrationDate" required="true"
								onChange="action-event-group-comput-registration-amount" />
						<field name="amount" />
						<field name="isSendEmail" readonly="true" />
				</panel>

		</form>

		<action-view name="action-event-events-dashlet" title="Event"
				model="com.axelor.apps.event.db.Events">
				<view type="grid" name="event-grid" />
				<view type="form" name="event-form" />
		</action-view>



		<!-- Validation -->

		<action-group name="action-event-group-comput-registration-amount">
				<action name="event-action-registration-set-event" if="event == null" />
				<action name="event-action-registration-check-date" />
				<action name="action-event-comput-registration-amount" />
		</action-group>
		<action-group name="event-action-group-registration-validation">
				<action name=" event-action-registration-check-capacity " if="event != null" />
		</action-group>


		<action-method name="event-action-registration-set-event">
				<call class="com.axelor.apps.event.web.EventRegistrationController" method="setEvent" />
		</action-method>

		<action-validate name="event-action-registration-check-capacity">

				<error message="This event capacity is exceed."
						if="eval:event !=null &amp;&amp; event.capacity ==(int) __repo__(EventRegistrations).all().filter('self.event= :event').bind('event', event).count()" />

		</action-validate>

		<action-condition name="event-action-registration-check-date">
				<check error="Please select the event." field="event" />
				<check field="registrationDate"
						if="event != null &amp;&amp; event.registrationOpen &gt; registrationDate.toLocalDate() || event != null &amp;&amp; event.registrationClose &lt; registrationDate.toLocalDate()"
						error="Registration date  is not between open and close registration dates." />

		</action-condition>

		<action-method name="action-event-comput-registration-amount">
				<call class="com.axelor.apps.event.web.EventRegistrationController"
						method="computeRegisterationAmount" if="registrationDate != null" />
		</action-method>

		<!-- wizard open from import -->



		<form name="event-registration-form-wizard " title="Event Registration"
				model="com.axelor.apps.base.db.Wizard" width="large">


				<panel>
						<field name="$envImportFile" title="File" type="many-to-one" widget="binary-link"
								target="com.axelor.meta.db.MetaFile" />
						<!-- <field name="$csvMetaFile" title="Csv generated" type="many-to-one" widget="binary-link" -->
						<!-- target="com.axelor.meta.db.MetaFile" readonly="true" /> -->
				</panel>

				<panel sidebar="true">
						<button name="importBtn" title="Import" onClick="action-event-save-wizard" colSpan="12"
								width="200px" readonlyIf="$envImportFile == null" />
				</panel>


		</form>

		<action-method name="event-action-registration-change-event-details">
				<call class="com.axelor.apps.event.web.EventRegistrationController"
						method="changeEventDetail" />
		</action-method>

		<action-method name="action-event-save-wizard">
				<call class="com.axelor.apps.event.web.ImportController" method="importCSVData" />
		</action-method>

</object-views>
