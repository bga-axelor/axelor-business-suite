<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.1.xsd">

	<grid name="invoice-line-grid" id="gst-invoice-line-grid"
		title="Invoice lines" model="com.axelor.apps.account.db.InvoiceLine"
		expandable="true">

		<extend target="//field[@name='unit']">
			<insert position="after">
				<field name="gstRate" if="__config__.app.isApp('gst')" />
				<field name="igst" if="__config__.app.isApp('gst')" />
				<field name="sgst" if="__config__.app.isApp('gst')" />
				<field name="cgst" if="__config__.app.isApp('gst')" />
			</insert>
		</extend>

		<extend target="//field[@name='inTaxTotal']">
			<insert position="after">
				<field name="grossAmount" if="__config__.app.isApp('gst')" />
			</insert>
		</extend>

	</grid>

	<form name="invoice-line-form" id="gst-invoice-line-form"
		title="Invoice line" model="com.axelor.apps.account.db.InvoiceLine"
		width="large" readonlyIf="$isReadOnly"
		onNew="action-account-invoice-line-onnew-group"
		onLoad="action-group-account-invoice-line-onload" extension="true">

		<extend target="//field[@name='packPriceSelect']">
			<insert position="after">
				<field name="hsbn" if="__config__.app.isApp('gst')" />
			</insert>
		</extend>

		<extend target="//field[@name='exTaxTotal']">
			<insert position="after">
				<field name="gstRate" if="__config__.app.isApp('gst')" />
				<field name="igst" if="__config__.app.isApp('gst')" />
				<field name="sgst" if="__config__.app.isApp('gst')" />
				<field name="cgst" if="__config__.app.isApp('gst')" />
			</insert>
		</extend>

		<extend target="//field[@name='inTaxTotal']">
			<insert position="after">
				<field name="gstRate" if="__config__.app.isApp('gst')" />
				<field name="grossAmount" if="__config__.app.isApp('gst')" />
			</insert>
		</extend>

		<extend target="//field[@name='price']">
			<attribute name="onChange"
				value="action-invoice-line-method-onchange-price,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount,action-group-gst-invoice-line-price-onChange" />
		</extend>
		
		<extend target="//field[@name='qty']">
			<attribute name="onChange"
				value="action-group-account-invoice-line-qty-onchange,action-group-gst-invoice-line-qty-onChange" />
		</extend>
	</form>

	<!-- GST Start -->
	<!-- <action-group name="action-group-gst-invoice-line-product-onChange"> -->
	<!-- <action name="action-gst-invoice-line-gst-rate" if="__config__.app.isApp('gst')" 
		/> -->
	<!-- <action name="action-gst-invoice-line-calculate" if="__config__.app.isApp('gst')" 
		/> -->
	<!-- </action-group> -->

	<action-group
		name="action-group-gst-invoice-line-qty-onChange">
		<action name="action-gst-invoice-line-calculate"
			if="__config__.app.isApp('gst')" />
	</action-group>

	<!-- try with extends method -->

	<action-group
		name="action-group-gst-invoice-line-price-onChange">
		<action name="action-gst-invoice-line-gst-rate"
			if="__config__.app.isApp('gst')" />
		<action name="action-gst-invoice-line-calculate"
			if="__config__.app.isApp('gst')" />
	</action-group>

	<action-attrs name="action-gst-invoice-line-gst-rate">
		<attribute name="value" for="gstRate"
			expr="eval:product?.gstRate" />
		<attribute name="value" for="hsbn" expr="eval:product?.hsbn" />

	</action-attrs>


	<action-method name="action-gst-invoice-line-calculate">
		<call class="com.axelor.apps.gst.web.InvoiceLineController"
			method="calculate" />
	</action-method>

	<!-- GST end -->

</object-views>
